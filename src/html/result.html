<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>結果</title>
    <link rel="stylesheet" href="../css/styles.css" />
  </head>
  <body>
    <div class="container">
      <h1>結果</h1>
      <p id="character-stats-strength"></p>
      <p id="character-stats-agility"></p>
      <p id="character-stats-intelligence"></p>
      <p id="character-stats-age"></p>
      <p id="character-stats-size"></p>
      <p id="character-stats-softness"></p>
      <img
        id="character-image"
        src="https://via.placeholder.com/150"
        alt="キャラクター画像"
        class="character-image"
      />
      <button onclick="goBack()" class="back-btn">戻る</button>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>
      // URLのパラメータからデータを取得
      const urlParams = new URLSearchParams(window.location.search);
      const strength = urlParams.get("strength");
      const agility = urlParams.get("agility");
      const intelligence = urlParams.get("intelligence");
      const age = urlParams.get("age");
      const size = urlParams.get("size");
      const softness = urlParams.get("softness");

      // 結果を表示
      const resultIntelligence = `知性: ${intelligence}`;
      const resultStrength = `攻撃力: ${strength}`; 
      const resultAge = `年齢: ${age}`; 
      const resultSize = `大きさ: ${size}`;
      const resultSoftness = `柔らかさ: ${softness}`;
      const resultAgility = `敏捷性: ${agility}`;
      document.getElementById("character-stats-strength").textContent = resultStrength;
      document.getElementById("character-stats-agility").textContent = resultAgility;
      document.getElementById("character-stats-intelligence").textContent = resultIntelligence;
      document.getElementById("character-stats-age").textContent = resultAge;
      document.getElementById("character-stats-size").textContent = resultSize;
      document.getElementById("character-stats-softness").textContent = resultSoftness;

      // 戻るボタンの処理
      function goBack() {
        window.history.go(-2); // 2つ前のページに戻る
      }

      // resultText を使ってPOSTリクエストを送信
      $.ajax({
        type: "POST",
        url: "https://ishinomakihack2024.azurewebsites.net/api/CreateImage", // 指定されたターゲットURL
        contentType: "application/json",
        data: JSON.stringify({ message: resultText }), // resultTextの内容を送信
        dataType: "json",
      })
        .done(function (response) {
          console.log("Success:", response);

          if (response.status) {
            // 返ってきたBase64エンコードされた画像データを取得
            const base64Image = response.base64Image;

            // imgタグのsrc属性に画像データをセット
            $("#character-image").attr(
              "src",
              `data:image/png;base64,${base64Image}`
            );
          } else {
            console.error("Error: No image data found");
          }
        })
        .fail(function (jqXHR, textStatus, errorThrown) {
          console.error("Error:", textStatus, errorThrown);
        });
    </script>
  </body>
</html>
